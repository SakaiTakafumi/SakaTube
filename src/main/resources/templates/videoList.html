<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8" />
	<title>動画一覧</title>
		<!-- Bootstrap CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"></link>
</head>
<body>

	<!-- jQuery、Popper.js、Bootstrap JS -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js" type="text/javascript" ></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

		<!-- ボタン -->
		<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#demoNormalModal">動画アップロード</button>

		<!-- モーダルダイアログ -->
		<div class="modal fade" id="demoNormalModal" tabindex="-1" role="dialog" aria-labelledby="modal" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="demoModalTitle">動画アップロード</h5>
					</div>

					<form id="data-upload-form" th:object="${videoInfo}" name="videoInfo" enctype="multipart/form-data" method="post" th:unless="true">
						<div class="modal-body">タイトル</div>
						<input type="text" th:field="*{title}" size="30" />

						<div class="modal-body">説明</div>
						<textarea rows="5" cols="48" th:field="*{note}" />

						<div class="modal-body">ファイル</div>
						<input type="file" name="example" size="30" th:field="*{video}" />

						<div class="modal-footer">
							<button  class="btn btn-secondary" data-dismiss="modal">閉じる</button>
							<input class="btn btn-primary" id="data_upload_button" type="submit" value="アップロード" />
						</div>
					</form>

					<div class="upload-complete" th:unless="false">
						<div class="modal-body">アップロードが完了しました</div>
						<div class="modal-footer">
							<button  class="btn btn-secondary" data-dismiss="modal">閉じる</button>
							<input class="btn btn-primary" id="upload-continue" type="submit" value="続ける" />
						</div>
					</div>
				</div>
			</div>
		</div>
</body>

<script th:inline="javascript">
/*<![CDATA[*/
// 主処理部
$(function(){

	// アップロードボタンを押下
	$("#data-upload-form").submit(function(event){
		// タイトル
//		if(document.videoInfo.title.value != "") {
//    		window.alert(document.videoInfo.title.value);
//		}

    	// 説明
//		if(document.videoInfo.note.value != "") {
//    		window.alert(document.videoInfo.note.value);
//		}

		// video
//		if(document.videoInfo.note.value != "") {
//			window.alert(document.videoInfo.video.value);
//		}

		// 要素規定の動作をキャンセルする
		event.preventDefault();
		var formData = new FormData($(this)[0]);

		var hostUrl= 'http://localhost:8080/sakaTube/videoUpload';

		$.ajax({
			url: hostUrl,
			type:'POST',
			dataType: 'json',
			processData: false,
			contentType: false,
			data : formData,
		}).done(function(data) {
			alert("アップロードが完了しました");
		}).fail(function(XMLHttpRequest, textStatus, errorThrown) {
			alert("エラーが発生しました");
		})

//		alert("アップロードが失敗しました。");
	});

	// 続けるボタンを押下
	$("#upload-continue").click(function(event){
//		alert("続けます");
	});
});

/*]]>*/

</script>

</html>